\doxysection{visibility\+\_\+aperture\+\_\+finder.\+h}
\hypertarget{visibility__aperture__finder_8h_source}{}\label{visibility__aperture__finder_8h_source}\index{E:/External/visilib/visilib/visibility\_aperture\_finder.h@{E:/External/visilib/visilib/visibility\_aperture\_finder.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{Visilib,\ an\ open\ source\ library\ for\ exact\ visibility\ computation.}}
\DoxyCodeLine{00003\ \textcolor{comment}{Copyright(C)\ 2021\ by\ Denis\ Haumont}}
\DoxyCodeLine{00004\ \textcolor{comment}{}}
\DoxyCodeLine{00005\ \textcolor{comment}{This\ file\ is\ part\ of\ Visilib.}}
\DoxyCodeLine{00006\ \textcolor{comment}{}}
\DoxyCodeLine{00007\ \textcolor{comment}{Visilib\ is\ free\ software\ :\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00008\ \textcolor{comment}{it\ under\ the\ terms\ of\ the\ GNU\ General\ Public\ License\ as\ published\ by}}
\DoxyCodeLine{00009\ \textcolor{comment}{the\ Free\ Software\ Foundation,\ either\ version\ 3\ of\ the\ License,\ or}}
\DoxyCodeLine{00010\ \textcolor{comment}{(at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00011\ \textcolor{comment}{}}
\DoxyCodeLine{00012\ \textcolor{comment}{Visilib\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{00013\ \textcolor{comment}{but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{00014\ \textcolor{comment}{MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.See\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{GNU\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00016\ \textcolor{comment}{}}
\DoxyCodeLine{00017\ \textcolor{comment}{You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ General\ Public\ License}}
\DoxyCodeLine{00018\ \textcolor{comment}{along\ with\ Visilib.\ If\ not,\ see\ <http://www.gnu.org/licenses/>}}
\DoxyCodeLine{00019\ \textcolor{comment}{*/}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}visibility\_solver.h"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}visibility\_aperture\_finder.h"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}geometry\_convex\_polygon.h"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}silhouette\_mesh\_face.h"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}math\_plucker\_2.h"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}math\_predicates.h"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}plucker\_polyhedron.h"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}plucker\_polytope.h"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}plucker\_polytope\_complex.h"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}plucker\_polytope\_splitter.h"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}visibility\_exact\_query.h"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}silhouette.h"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <fstream>}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00039\ \textcolor{keyword}{namespace\ }visilib}
\DoxyCodeLine{00040\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ P>}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{class\ \ }PluckerPolytope;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ P,\ \textcolor{keyword}{class}\ S>}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classvisilib_1_1_visibility_aperture_finder}{VisibilityApertureFinder}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classvisilib_1_1_visibility_solver}{VisibilitySolver}}<P,\ S>}
\DoxyCodeLine{00052\ \ \ \ \ \{}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvisilib_1_1_visibility_aperture_finder}{VisibilityApertureFinder}}(\mbox{\hyperlink{classvisilib_1_1_visibility_exact_query__}{VisibilityExactQuery\_<P,\ S>}}*\ aSolver,}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ normalization,}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ S\ tolerance,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ detectApertureOnly);}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ VisibilityResult\ resolve();}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ VisibilityResult\ resolveInternal(\mbox{\hyperlink{classvisilib_1_1_plucker_polytope}{PluckerPolytope<P>}}*\ aPolytope,\ \textcolor{keyword}{const}\ std::string\&\ occlusionTreeNodeSymbol,\ \textcolor{keyword}{const}\ std::vector<Silhouette*>\&\ anOccluders,\ \textcolor{keyword}{const}\ std::vector<P>\&\ aPolytopeLines,\ \textcolor{keywordtype}{int}\ depth);}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ resize(\textcolor{keywordtype}{size\_t}\ myInitiaLineCount,\ \mbox{\hyperlink{classvisilib_1_1_plucker_polyhedron}{PluckerPolyhedron<P>}}*\ myPolyhedron,\ \mbox{\hyperlink{classvisilib_1_1_plucker_polytope}{PluckerPolytope<P>}}*\ aPolytope);}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ extractStabbingLines(\mbox{\hyperlink{classvisilib_1_1_plucker_polyhedron}{PluckerPolyhedron<P>}}*\ myPolyhedron,\ \mbox{\hyperlink{classvisilib_1_1_plucker_polytope}{PluckerPolytope<P>}}*\ aPolytope);}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ mNormalization;}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ mDetectApertureOnly;}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ S\ mTolerance;}
\DoxyCodeLine{00069\ \ \ \ \ \};}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ P,\ \textcolor{keyword}{class}\ S>}
\DoxyCodeLine{00072\ \ \ \ \ \mbox{\hyperlink{classvisilib_1_1_visibility_aperture_finder}{VisibilityApertureFinder<P,\ S>::VisibilityApertureFinder}}(\mbox{\hyperlink{classvisilib_1_1_visibility_exact_query__}{VisibilityExactQuery\_<P,\ S>}}*\ mQuery,\ \textcolor{keywordtype}{bool}\ normalization,\ S\ tolerance,\ \textcolor{keywordtype}{bool}\ detectApertureOnly)}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classvisilib_1_1_visibility_solver}{VisibilitySolver}}<P,\ S>(mQuery),}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ mNormalization(normalization),}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ mTolerance(tolerance),}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ mDetectApertureOnly(detectApertureOnly)}
\DoxyCodeLine{00077\ \ \ \ \ \{}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ P,\ \textcolor{keyword}{class}\ S>}
\DoxyCodeLine{00081\ \ \ \ \ VisibilityResult\ VisibilityApertureFinder<P,\ S>::resolve()}
\DoxyCodeLine{00082\ \ \ \ \ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ resolveInternal(\textcolor{keyword}{reinterpret\_cast<}PluckerPolytope<P>*\textcolor{keyword}{>}(VisibilitySolver<P,\ S>::mQuery-\/>getComplex()-\/>getRoot()),\ \textcolor{stringliteral}{"{}*"{}},\ std::vector<Silhouette*>(),\ std::vector<P>(),\ 0);}
\DoxyCodeLine{00084\ \ \ \ \ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ P,\ \textcolor{keyword}{class}\ S>}
\DoxyCodeLine{00087\ \ \ \ \ VisibilityResult\ VisibilityApertureFinder<P,\ S>::resolveInternal(PluckerPolytope<P>*\ aPolytope,\ \textcolor{keyword}{const}\ std::string\&\ occlusionTreeNodeSymbol,\ \textcolor{keyword}{const}\ std::vector<Silhouette*>\&\ anOccluders,\ \textcolor{keyword}{const}\ std::vector<P>\&\ aPolytopeLines,\ \textcolor{keywordtype}{int}\ aDepth)}
\DoxyCodeLine{00088\ \ \ \ \ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ PluckerPolyhedron<P>*\ myPolyhedron\ =\ \textcolor{keyword}{reinterpret\_cast<}PluckerPolyhedron<P>*\textcolor{keyword}{>}\ (VisibilitySolver<P,\ S>::mQuery-\/>getComplex()-\/>getPolyhedron());}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ myInitiaLineCount\ =\ myPolyhedron-\/>getLinesCount();}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ std::ofstream\&\ debugOutput\ =\ VisibilitySolver<P,\ S>::mDebugger-\/>getDebugOutput();\ \ \ \ }
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}Resolve\ internal\ "{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ aPolytope-\/>outputProperties(debugOutput,\ myPolyhedron);}
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ VisibilityResult\ globalResult\ =\ HIDDEN;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (aDepth\ >\ 200)}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}Overflow\ detected:\ more\ than\ 200\ recursive\ calls...."{}}\ <<\ std::endl;}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}RESULT\ FAILURE:\ Overflow\ detected\ :\ more\ than\ 2000\ recursive\ calls...."{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ V\_ASSERT(0);}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ FAILURE;}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ HelperScopedTimer\ timer(VisibilitySolver<P,\ S>::mQuery-\/>getStatistic(),\ STABBING\_LINE\_EXTRACTION);}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ aPolytope-\/>computeEdgesIntersectingQuadric(myPolyhedron,\ mTolerance);}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!aPolytope-\/>containsRealLines())}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}RESULT\ UNKNOWN:\ polytope\ does\ not\ contains\ real\ line"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00115\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ HIDDEN;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ V\_ASSERT(aPolytope-\/>isValid(myPolyhedron,\ mNormalization,\ mTolerance));}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasRay\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ std::vector<Silhouette*>\ myOccluders\ =\ anOccluders;}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ std::vector<P>\ polytopeLines\ =\ aPolytopeLines;}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (myOccluders.empty())}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!VisibilitySolver<P,\ S>::mQuery-\/>collectAllOccluders(aPolytope,\ myPolyhedron,\ myOccluders,\ polytopeLines))}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Early\ stop\ -\/\ an\ aperture\ has\ been\ found:\ the\ source\ polygons\ are\ mutually\ visible}}
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}RAY:\ IS\ VISIBLE"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00131\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hasRay\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ globalResult\ =\ VISIBLE;}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mDetectApertureOnly)}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ VISIBLE;}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00141\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}RAY:\ IS\ OCCLUDED"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00143\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ HelperScopedTimer\ timer(VisibilitySolver<P,\ S>::mQuery-\/>getStatistic(),\ OCCLUDER\_TREATMENT);}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (VisibilitySolver<P,\ S>::mQuery-\/>isOccluded(aPolytope,\ myPolyhedron,\ myOccluders,\ polytopeLines))}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00151\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}COUNT:\ IS\ OCCLUDED"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00153\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ HIDDEN;}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00158\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}COUNT:\ maybe\ VISIBLE"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00160\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ Silhouette*\ mySilhouette\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ mySilhouetteEdgeIndex\ =\ 0;}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasEdge\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isVisible\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ hasEdge\ =\ VisibilitySolver<P,\ S>::mQuery-\/>findNextEdge(mySilhouetteEdgeIndex,\ mySilhouette,\ aPolytope,\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (hasEdge)\ \textcolor{comment}{//\ a\ candidate\ edge\ has\ been\ found.\ we\ will\ split\ the\ polytope\ with\ the\ hyperplane\ of\ this\ edge.}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ SilhouetteEdge\&\ myVisibilitySilhouetteEdge\ =\ mySilhouette-\/>getEdge(mySilhouetteEdgeIndex);}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ SilhouetteMeshFace*\ face\ =\ myVisibilitySilhouetteEdge.mFace;}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ V\_ASSERT(myVisibilitySilhouetteEdge.mIsActive);}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ deactivate\ the\ candidate\ edge\ for\ further\ recursion}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ mySilhouette-\/>setEdgeActive(mySilhouetteEdgeIndex,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ MathVector2i\ edge\ =\ face-\/>getEdge(myVisibilitySilhouetteEdge.mEdgeIndex);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ the\ Plucker\ representation\ of\ the\ edge\ and\ add\ hyperplane\ of\ the\ edge\ and\ add\ it\ to\ the\ polyhedron}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ MathVector3d\ a\ =\ convert<MathVector3d>(face-\/>getVertex(edge.x));}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ MathVector3d\ b\ =\ convert<MathVector3d>(face-\/>getVertex(edge.y));}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ intersect\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ HelperScopedTimer\ timer(VisibilitySolver<P,\ S>::mQuery-\/>getStatistic(),\ OCCLUDER\_TREATMENT);}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ intersect\ =\ MathGeometry::isEdgeInsidePolytope(a,\ b,\ aPolytope,\ VisibilitySolver<P,\ S>::mQuery-\/>getApproximateNormal(),\ myPolyhedron,\ mTolerance);}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (intersect)}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (VisibilitySolver<P,\ S>::mDebugger\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VisibilitySolver<P,\ S>::mDebugger-\/>addRemovedEdge(face-\/>getVertex(edge.x),\ face-\/>getVertex(edge.y));}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ myPolyhedronFace\ =\ myVisibilitySilhouetteEdge.mHyperPlaneIndex;}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (myPolyhedronFace\ ==\ 0)}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ P\ myHyperplane(a,\ b);}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mNormalization)}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myHyperplane\ =\ myHyperplane.getNormalized();}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myPolyhedronFace\ =\ myPolyhedron-\/>add(myHyperplane,\ ON\_BOUNDARY,\ mNormalization,\ mTolerance);}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myVisibilitySilhouetteEdge.mHyperPlaneIndex\ =\ myPolyhedronFace;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ P\ myHyperplane\ =\ myPolyhedron-\/>get(myPolyhedronFace);}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeometryPositionType\ myResult\ =\ ON\_NEGATIVE\_SIDE;}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PluckerPolytope<P>*\ myPolytopeLeft\ =\ \textcolor{keyword}{new}\ PluckerPolytope<P>();}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PluckerPolytope<P>*\ myPolytopeRight\ =\ \textcolor{keyword}{new}\ PluckerPolytope<P>();}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ HelperScopedTimer\ timer(VisibilitySolver<P,\ S>::mQuery-\/>getStatistic(),\ POLYTOPE\_SPLIT);}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VisibilitySolver<P,\ S>::mQuery-\/>getStatistic()-\/>inc(POLYTOPE\_SPLIT\_COUNT);}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}PERFORM\ THE\ SPLIT"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00226\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myResult\ =\ \mbox{\hyperlink{classvisilib_1_1_plucker_polytope_splitter_a50150fef5b24618c067c14c5e5fdb438}{PluckerPolytopeSplitter<P,\ S>::split}}(myPolyhedron,\ myHyperplane,\ aPolytope,\ myPolytopeLeft,\ myPolytopeRight,\ myPolyhedronFace,\ mNormalization,\ mTolerance);}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (VisibilitySolver<P,\ S>::mQuery-\/>getStatistic()-\/>get(POLYTOPE\_SPLIT\_COUNT)\ \%\ 10000\ ==\ 0)}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VisibilitySolver<P,\ S>::mQuery-\/>getStatistic()-\/>displayCounts();}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ std::endl;}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector\ <PluckerPolytope<P>*>\ myPolytopes;}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector\ <std::string>\ postFix;}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<bool>\ reuseOccluders;}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (myResult\ ==\ ON\_BOUNDARY)}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_ASSERT(myPolytopeLeft\ \&\&\ myPolytopeRight);}
\DoxyCodeLine{00243\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}SPLIT\ SUCCESS\ -\/>recurse\ on\ Left\ and\ right\ childs"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00245\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ position\ =\ MathPredicates::getVertexPlaneRelativePosition(myHyperplane,\ polytopeLines[0],\ mTolerance);}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ left\ split}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reuseOccluders.push\_back(position\ !=\ ON\_POSITIVE\_SIDE);}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myPolytopes.push\_back(myPolytopeLeft);}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ postFix.push\_back(\textcolor{stringliteral}{"{}L"{}});}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ right\ split}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reuseOccluders.push\_back(position\ !=\ ON\_NEGATIVE\_SIDE);}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myPolytopes.push\_back(myPolytopeRight);}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ postFix.push\_back(\textcolor{stringliteral}{"{}R"{}});}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00260\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}NO\ SPLIT\ OCCURS\ -\/>\ recurse\ again\ on\ the\ same\ polytope"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00262\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reuseOccluders.push\_back(\textcolor{keyword}{true});}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ myPolytopes.push\_back(aPolytope);}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ postFix.push\_back(\textcolor{stringliteral}{"{}*"{}});}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ myPolytopeLeft;\ \ myPolytopeLeft\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ myPolytopeRight;\ myPolytopeRight\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ myPolytopes.size();\ i++)}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasBeenAdded\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (myResult\ ==\ ON\_BOUNDARY\ \&\&\ i\ ==\ 0\ ||\ myResult\ ==\ ON\_NEGATIVE\_SIDE)}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mySilhouette-\/>pushEdgeProcessed(mySilhouetteEdgeIndex);}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hasBeenAdded\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::stringstream\ ss;}
\DoxyCodeLine{00282\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ss\ <<\ occlusionTreeNodeSymbol\ <<\ \textcolor{stringliteral}{"{}|"{}}\ <<\ face-\/>getFaceIndex()\ <<\ \textcolor{stringliteral}{"{}-\/"{}}\ <<\ myVisibilitySilhouetteEdge.mEdgeIndex\ <<\ postFix[i];}
\DoxyCodeLine{00284\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VisibilityResult\ result;}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reuseOccluders[i])}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ resolveInternal(myPolytopes[i],\ ss.str(),\ myOccluders,\ polytopeLines,\ aDepth\ +\ 1);}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ resolveInternal(myPolytopes[i],\ ss.str(),\ std::vector<Silhouette*>(),\ std::vector<P>(),\ aDepth\ +\ 1);}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ FAILURE)}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ VISIBLE)}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ globalResult\ =\ VISIBLE;}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mDetectApertureOnly)\ \textcolor{comment}{//\ Early\ stop\ -\/\ an\ aperture\ has\ been\ found}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00303\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}EARLY\ STOP\ -\/\ aperture\ found"{}});}
\DoxyCodeLine{00305\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ myPolytopeLeft;\ \ myPolytopeLeft\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ myPolytopeRight;\ myPolytopeRight\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (hasBeenAdded)}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mySilhouette-\/>popEdgeProcessed(mySilhouetteEdgeIndex);}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ myPolytopeLeft;\ \ myPolytopeLeft\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ myPolytopeRight;\ myPolytopeRight\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::stringstream\ ss;}
\DoxyCodeLine{00324\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE\ \ \ \ \ \ \ \ \ \ \ \ \ \ }}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ss\ <<\ occlusionTreeNodeSymbol\ <<\ \textcolor{stringliteral}{"{}|"{}}\ <<\ face-\/>getFaceIndex()\ <<\ \textcolor{stringliteral}{"{}-\/"{}}\ <<\ myVisibilitySilhouetteEdge.mEdgeIndex\ <<\ \textcolor{stringliteral}{"{}*"{}};}
\DoxyCodeLine{00326\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VisibilityResult\ result\ =\ resolveInternal(aPolytope,\ ss.str(),\ anOccluders,\ aPolytopeLines,\ aDepth\ +\ 1);}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ FAILURE)}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ VISIBLE)}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ globalResult\ =\ VISIBLE;}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mDetectApertureOnly)\ \textcolor{comment}{//\ Early\ stop\ -\/\ an\ aperture\ has\ been\ found}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ reactivate\ the\ \ edge}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ mySilhouette-\/>setEdgeActive(mySilhouetteEdgeIndex,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ valid\ candidate\ edge\ has\ been\ found\ in\ the\ occluder\ set:\ all\ the\ set\ of\ lines\ represented\ by\ the\ polytope\ are\ blocked\ by\ at\ least\ one\ occluder:\ the\ recursion\ can\ stops.}}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ When\ it\ is\ the\ case\ for\ all\ the\ sub-\/polytopes\ created\ during\ the\ recursive\ traversal,\ the\ two\ polygons\ are\ mutually\ hidden.}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!mDetectApertureOnly)}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \{\ }
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!hasEdge)}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//We\ found\ a\ final\ polytope\ visible}}
\DoxyCodeLine{00353\ \textcolor{preprocessor}{\#ifdef\ OUTPUT\_DEBUG\_FILE}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ V\_LOG(debugOutput,\ \textcolor{stringliteral}{"{}visible\ polytope\ found:\ exporting\ stabbing\ lines"{}},\ occlusionTreeNodeSymbol);}
\DoxyCodeLine{00355\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ extractStabbingLines(myPolyhedron,\ aPolytope);}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ globalResult\ =\ VISIBLE;}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (myPolyhedron-\/>getLinesCount()\ !=\ myInitiaLineCount)}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ resize(myInitiaLineCount,\ myPolyhedron,\ aPolytope);}}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ globalResult;}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \ \ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ P,\ \textcolor{keyword}{class}\ S>}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keywordtype}{void}\ VisibilityApertureFinder<P,\ S>::resize(\textcolor{keywordtype}{size\_t}\ anInitiaLineCount,\ PluckerPolyhedron<P>*\ myPolyhedron,\ PluckerPolytope<P>*\ aPolytope)}
\DoxyCodeLine{00371\ \ \ \ \ \{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ HelperScopedTimer\ timer(VisibilitySolver<P,\ S>::mQuery-\/>getStatistic(),\ POLYTOPE\_SPLIT);}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ myPolyhedron-\/>resize(anInitiaLineCount);}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ v\ :\ aPolytope-\/>getVertices())}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<size\_t>\&\ facets\ =\ myPolyhedron-\/>getFacetsDescription(v);}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ facets.size();\ i++)}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (facets[i]\ >=\ anInitiaLineCount)}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ facets.resize(i);}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ P,\ \textcolor{keyword}{class}\ S>}
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{keywordtype}{void}\ VisibilityApertureFinder<P,\ S>::extractStabbingLines(PluckerPolyhedron<P>*\ myPolyhedron,\ PluckerPolytope<P>*\ aPolytope)}
\DoxyCodeLine{00390\ \ \ \ \ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ HelperScopedTimer\ timer(VisibilitySolver<P,\ S>::mQuery-\/>getStatistic(),\ STABBING\_LINE\_EXTRACTION);}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ MathPlane3d\ aPlane0\ =\ VisibilitySolver<P,\ S>::mQuery-\/>getQueryPolygon(0)-\/>getPlane();}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ MathPlane3d\ aPlane1\ =\ VisibilitySolver<P,\ S>::mQuery-\/>getQueryPolygon(1)-\/>getPlane();}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (aPolytope-\/>getExtremalStabbingLinesCount()\ ==\ 0)}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ aPolytope-\/>computeExtremalStabbingLines(myPolyhedron,\ mTolerance);}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (VisibilitySolver<P,\ S>::mDebugger\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \{\ \ }
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::pair<MathVector3d,\ MathVector3d>>\ lines;}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ aPolytope-\/>getExtremalStabbingLinesBackTo3D(lines,\ aPlane0,\ aPlane1);}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ line\ :\ lines)}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ VisibilitySolver<P,\ S>::mDebugger-\/>addExtremalStabbingLine(convert<MathVector3f>(line.first),\ convert<MathVector3f>(line.second));}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \ \ \}}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \}}

\end{DoxyCode}
